<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <!-- MediaPipe CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }

    .container {
      position: relative;
      width: 1280px;
      height: 720px;
    }

    video, canvas {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    video {
      transform: scaleX(-1); /* Mirror */
    }

    canvas {
    }
  </style>
</head>

<body>
  <div class="container">
    <video class="input_video" autoplay playsinline></video>
    <canvas class="output_canvas"></canvas>
  </div>

  <script>
    function onResults(results) {
  canvasCtx.save();
  canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

  canvasCtx.drawImage(
    results.image,
    0, 0,
    canvasElement.width,
    canvasElement.height
  );

  let displayCount = 0; // define outside loop

  if (results.multiHandLandmarks) {
    for (const landmarks of results.multiHandLandmarks) {

      let fingers = [];

      // Thumb
      fingers.push(landmarks[4].x < landmarks[3].x ? 1 : 0);

      // Index
      fingers.push(landmarks[8].y < landmarks[6].y ? 1 : 0);

      // Middle
      fingers.push(landmarks[12].y < landmarks[10].y ? 1 : 0);

      // Ring
      fingers.push(landmarks[16].y < landmarks[14].y ? 1 : 0);

      // Pinky
      fingers.push(landmarks[20].y < landmarks[18].y ? 1 : 0);

      let count = fingers.reduce((a, b) => a + b, 0);
      displayCount = count; // store latest count

      drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS,
        { color: '#00FF00', lineWidth: 4 });

      drawLandmarks(canvasCtx, landmarks,
        { color: '#FF0000', lineWidth: 2 });
    }
  }

  canvasCtx.font = "40px Arial";
  canvasCtx.fillStyle = "yellow";
  canvasCtx.fillText("Fingers: " + displayCount, 50, 100);

  canvasCtx.restore();
}

  </script>
</body>
</html>
